# ===========================================================================
# Desktop App Types
# ===========================================================================
# These types are used by the Tauri desktop application for download
# management, license validation, and OAuth authentication.
# ===========================================================================

# Supported music services for downloads (matches Rust serialization - PascalCase)
MusicService:
  type: string
  enum:
    - YouTube
    - Spotify
    - SoundCloud
    - Deezer
    - Tidal
    - AppleMusic
    - Bandcamp
    - Unknown
  description: |
    Music service identifier:
    - YouTube: YouTube tracks/playlists
    - Spotify: Spotify tracks/albums/playlists (via ISRC lookup)
    - SoundCloud: SoundCloud tracks
    - Deezer: Direct Deezer downloads
    - Tidal: Tidal tracks
    - AppleMusic: Apple Music tracks
    - Bandcamp: Bandcamp releases
    - Unknown: Unrecognized service

# Download status enum (matches Rust serialization - PascalCase)
DownloadStatus:
  type: string
  enum:
    - Queued
    - Downloading
    - Converting
    - Complete
    - Error
  description: |
    Download job status:
    - Queued: Waiting to start
    - Downloading: Actively downloading
    - Converting: Converting/processing audio
    - Complete: Successfully finished
    - Error: Failed with error

# Track metadata for a download
TrackMetadata:
  type: object
  required:
    - title
    - artist
  properties:
    title:
      type: string
      description: Track title
      example: "היה טוב"
    artist:
      type: string
      description: Primary artist name
      example: "Omer Adam"
    album:
      type: string
      description: Album name
      example: "תסמינים של פרידה"
    isrc:
      type: string
      description: International Standard Recording Code (if available)
      example: "IL1012501110"
    duration:
      type: integer
      description: Track duration in seconds
      example: 214
    releaseDate:
      type: string
      description: Release date (ISO format)
      example: "2025-06-10"
    imageUrl:
      type: string
      format: uri
      description: Album/track cover art URL
      example: "https://i.scdn.co/image/ab67616d0000b27312d961970aa13291d9720f8b"
    trackNumber:
      type: integer
      description: Track number in album (if applicable)
      example: 3

# Download context (album/playlist info)
DownloadContext:
  type: object
  description: Additional context for batch downloads (albums/playlists)
  properties:
    type:
      type: string
      enum: [single, album, playlist]
      description: Download type
    albumName:
      type: string
      description: Album name (for album downloads)
    playlistName:
      type: string
      description: Playlist name (for playlist downloads)
    totalTracks:
      type: integer
      description: Total number of tracks in album/playlist
    currentTrack:
      type: integer
      description: Current track number being processed

# Individual download job
DownloadJob:
  type: object
  required:
    - id
    - url
    - service
    - status
    - progress
    - message
    - metadata
    - created_at
  properties:
    id:
      type: string
      format: uuid
      description: Unique job identifier
      example: "550e8400-e29b-41d4-a716-446655440000"
    url:
      type: string
      format: uri
      description: Original source URL
      example: "https://open.spotify.com/track/5omHkj4qY0A8f6mE4T3fAH"
    service:
      $ref: '#/MusicService'
    status:
      $ref: '#/DownloadStatus'
    progress:
      type: number
      minimum: 0
      maximum: 100
      description: Download progress percentage (0.0 to 100.0)
      example: 75.5
    message:
      type: string
      description: Current status message
      example: "Downloading... 75.5%"
    metadata:
      $ref: '#/TrackMetadata'
    output_path:
      type: string
      description: Local file path (when completed)
      example: "/Users/user/Music/Omer Adam - היה טוב.mp3"
    error:
      type: string
      description: Error message (if status is Error)
      example: "Track not found on Deezer"
    created_at:
      type: integer
      description: Job creation timestamp (Unix timestamp)
      example: 1704722400
    started_at:
      type: integer
      description: Download start timestamp (Unix timestamp)
      example: 1704722405
    completed_at:
      type: integer
      description: Download completion timestamp (Unix timestamp)
      example: 1704722450

# Queue status (for desktop app UI)
QueueStatus:
  type: object
  required:
    - jobs
    - active_count
    - queued_count
    - completed_count
    - error_count
    - is_processing
  properties:
    jobs:
      type: array
      items:
        $ref: '#/DownloadJob'
      description: List of all jobs in queue
    active_count:
      type: integer
      description: Number of active/downloading jobs
      example: 2
    queued_count:
      type: integer
      description: Number of queued jobs waiting to start
      example: 3
    completed_count:
      type: integer
      description: Number of completed jobs
      example: 7
    error_count:
      type: integer
      description: Number of failed jobs
      example: 1
    is_processing:
      type: boolean
      description: Whether queue processor is currently running
      example: true

# License status (used by desktop app to validate subscription)
# Field names match Rust snake_case serialization
LicenseStatus:
  type: object
  required:
    - is_valid
    - status
    - uuid
  properties:
    is_valid:
      type: boolean
      description: Whether user has active hasod-downloader subscription
      example: true
    status:
      type: string
      enum: [registered, not_registered, expired, suspended, error]
      description: License status
      example: "registered"
    uuid:
      type: string
      description: Device UUID
      example: "550e8400-e29b-41d4-a716-446655440000"
    email:
      type: string
      format: email
      description: User email
      example: "user@example.com"
    registration_url:
      type: string
      format: uri
      description: Registration URL (if not registered)
      example: "https://hasod-41a23.web.app/subscriptions?device_uuid=xxx"
    expires_at:
      type: string
      description: Subscription expiration date
      example: "2026-12-31"
    error:
      type: string
      description: Error message (if status is error)
      example: "Network error"

# OAuth authentication result (matches Rust snake_case serialization)
OAuthStartResult:
  type: object
  required:
    - auth_url
    - state
  properties:
    auth_url:
      type: string
      format: uri
      description: OAuth authorization URL to open in browser
      example: "https://accounts.google.com/o/oauth2/v2/auth?client_id=..."
    state:
      type: string
      description: CSRF state parameter for validation
      example: "random-state-string-12345"

# Stored authentication tokens (matches Rust snake_case serialization)
StoredAuth:
  type: object
  required:
    - email
    - id_token
    - refresh_token
    - expires_at
    - device_id
  properties:
    email:
      type: string
      format: email
      description: User email
      example: "user@example.com"
    id_token:
      type: string
      description: Firebase ID token (JWT)
    refresh_token:
      type: string
      description: Firebase refresh token
    expires_at:
      type: integer
      description: Token expiration timestamp (Unix timestamp)
      example: 1704722400
    device_id:
      type: string
      description: Device identifier
      example: "hw-1234567890abcdef"
